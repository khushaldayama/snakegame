- name: Build APK
  run: |
    cd snake_game
    buildozer init || true

    # Add build tools version to prevent default 36.0.0 usage
    echo "android.build_tools_version = 30.0.3" >> buildozer.spec

    # Trigger buildozer to download its SDK
    buildozer android clean

    # Manually install cmdline-tools into Buildozer's SDK path
    mkdir -p ~/.buildozer/android/platform/android-sdk/cmdline-tools
    cd ~/.buildozer/android/platform/android-sdk/cmdline-tools
    wget https://dl.google.com/android/repository/commandlinetools-linux-9477386_latest.zip -O tools.zip
    unzip tools.zip
    mv cmdline-tools latest

    # Accept licenses in correct SDK
    yes | ~/.buildozer/android/platform/android-sdk/cmdline-tools/latest/bin/sdkmanager --sdk_root=~/.buildozer/android/platform/android-sdk --licenses

    # Install specific build tools into that SDK
    ~/.buildozer/android/platform/android-sdk/cmdline-tools/latest/bin/sdkmanager \
      --sdk_root=~/.buildozer/android/platform/android-sdk \
      "platform-tools" "platforms;android-31" "build-tools;30.0.3"

    # Go back to project folder and build
    cd ~/work/snakegame/snakegame/snake_game
    buildozer -v android debug
